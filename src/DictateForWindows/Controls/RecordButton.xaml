<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="DictateForWindows.Controls.RecordButton"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DictateForWindows.Controls">

    <Grid>
        <!-- Pulse animation ring -->
        <Ellipse
            x:Name="PulseRing"
            Width="72"
            Height="72"
            Fill="Transparent"
            Stroke="{ThemeResource AccentFillColorDefaultBrush}"
            StrokeThickness="2"
            Opacity="0">
            <Ellipse.RenderTransform>
                <ScaleTransform x:Name="PulseScale" ScaleX="1" ScaleY="1" CenterX="36" CenterY="36"/>
            </Ellipse.RenderTransform>
        </Ellipse>

        <!-- Main button -->
        <Button
            x:Name="MainButton"
            Width="64"
            Height="64"
            CornerRadius="32"
            Padding="0"
            Background="{ThemeResource AccentFillColorDefaultBrush}"
            BorderThickness="0"
            Click="OnButtonClick">

            <Grid>
                <!-- Microphone icon (not recording) -->
                <FontIcon
                    x:Name="MicIcon"
                    Glyph="&#xE720;"
                    FontSize="28"
                    Foreground="White"/>

                <!-- Stop icon (recording) -->
                <FontIcon
                    x:Name="StopIcon"
                    Glyph="&#xE71A;"
                    FontSize="20"
                    Foreground="White"
                    Visibility="Collapsed"/>

                <!-- Pause icon (paused) -->
                <FontIcon
                    x:Name="PauseIcon"
                    Glyph="&#xE768;"
                    FontSize="24"
                    Foreground="White"
                    Visibility="Collapsed"/>
            </Grid>
        </Button>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="RecordingStates">
                <VisualState x:Name="Idle">
                    <VisualState.Setters>
                        <Setter Target="MicIcon.Visibility" Value="Visible"/>
                        <Setter Target="StopIcon.Visibility" Value="Collapsed"/>
                        <Setter Target="PauseIcon.Visibility" Value="Collapsed"/>
                    </VisualState.Setters>
                </VisualState>

                <VisualState x:Name="Recording">
                    <VisualState.Setters>
                        <Setter Target="MicIcon.Visibility" Value="Collapsed"/>
                        <Setter Target="StopIcon.Visibility" Value="Visible"/>
                        <Setter Target="PauseIcon.Visibility" Value="Collapsed"/>
                        <Setter Target="MainButton.Background" Value="#E81123"/>
                    </VisualState.Setters>

                    <Storyboard>
                        <DoubleAnimationUsingKeyFrames
                            Storyboard.TargetName="PulseRing"
                            Storyboard.TargetProperty="Opacity"
                            RepeatBehavior="Forever">
                            <LinearDoubleKeyFrame KeyTime="0:0:0" Value="0.6"/>
                            <LinearDoubleKeyFrame KeyTime="0:0:1" Value="0"/>
                        </DoubleAnimationUsingKeyFrames>

                        <DoubleAnimationUsingKeyFrames
                            Storyboard.TargetName="PulseScale"
                            Storyboard.TargetProperty="ScaleX"
                            RepeatBehavior="Forever">
                            <LinearDoubleKeyFrame KeyTime="0:0:0" Value="1"/>
                            <LinearDoubleKeyFrame KeyTime="0:0:1" Value="1.5"/>
                        </DoubleAnimationUsingKeyFrames>

                        <DoubleAnimationUsingKeyFrames
                            Storyboard.TargetName="PulseScale"
                            Storyboard.TargetProperty="ScaleY"
                            RepeatBehavior="Forever">
                            <LinearDoubleKeyFrame KeyTime="0:0:0" Value="1"/>
                            <LinearDoubleKeyFrame KeyTime="0:0:1" Value="1.5"/>
                        </DoubleAnimationUsingKeyFrames>
                    </Storyboard>
                </VisualState>

                <VisualState x:Name="Paused">
                    <VisualState.Setters>
                        <Setter Target="MicIcon.Visibility" Value="Collapsed"/>
                        <Setter Target="StopIcon.Visibility" Value="Collapsed"/>
                        <Setter Target="PauseIcon.Visibility" Value="Visible"/>
                        <Setter Target="MainButton.Background" Value="#FF8C00"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</UserControl>
